<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Открытка для ученика</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        #name-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #282c34 0%, #1a1e24 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2000;
            transition: opacity 1s ease-out;
        }
        .form-container {
            background: rgba(40, 44, 52, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        .form-title {
            color: #61dafb;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .form-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #61dafb;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            min-width: 0;
        }
        .form-button {
            background: #61dafb;
            color: #282c34;
            border: none;
            padding: 12px 25px;
            margin-top: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
        }
        .form-button:hover {
            background: #4fa8d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(97, 218, 251, 0.4);
        }
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #282c34 0%, #1a1e24 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
            transition: opacity 1s ease-out;
            display: none;
        }
        .python-logo-3d {
            width: 150px;
            height: 150px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(55, 118, 171, 0.6));
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        .loader-text {
            margin-top: 30px;
            font-size: 18px;
            color: #61dafb;
            text-shadow: 0 0 10px rgba(97, 218, 251, 0.5);
        }
        #card {
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s, transform 1s;
            max-width: 80%;
            display: none;
        }
        .mshp-logo {
            height: 60px;
            margin-bottom: 20px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)) brightness(0) saturate(100%) invert(27%) sepia(90%) saturate(1558%) hue-rotate(176deg) brightness(93%) contrast(101%);
        }
        .code {
            background-color: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 24px;
            margin: 20px 0;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        .keyword {
            color: #c678dd;
        }
        .string {
            color: #98c379;
        }
        h1 {
            color: #282c34;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            margin-top: 0;
        }
        .error-message {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 16px;
            display: none;
        }
        .signature-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
            padding-right: 50px;
            position: relative;
        }
        .signature {
            font-family: 'Caveat', cursive;
            font-size: 28px;
            color: #282c34;
            position: relative;
            display: inline-block;
        }
        .signature::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 0;
            height: 2px;
            background-color: #282c34;
            animation: underline 0.5s ease-out forwards;
            animation-delay: 2.1s;
        }
        @keyframes underline {
            0% { width: 0; }
            100% { width: 100%; }
        }
        .signature span {
            display: inline-block;
            opacity: 0;
            animation: letterAppear 0.3s forwards;
        }
        @keyframes letterAppear {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .signature span:nth-child(1) { animation-delay: 0.5s; }
        .signature span:nth-child(2) { animation-delay: 0.6s; }
        .signature span:nth-child(3) { animation-delay: 0.7s; }
        .signature span:nth-child(4) { animation-delay: 0.8s; }
        .signature span:nth-child(5) { animation-delay: 0.9s; }
        .signature span:nth-child(6) { animation-delay: 1.0s; }
        .signature span:nth-child(7) { animation-delay: 1.1s; }
        .signature span:nth-child(8) { animation-delay: 1.2s; }
        .signature span:nth-child(9) { animation-delay: 1.3s; }
        .signature span:nth-child(10) { animation-delay: 1.4s; }
        .signature span:nth-child(11) { animation-delay: 1.5s; }
        .signature span:nth-child(12) { animation-delay: 1.6s; }
        .signature span:nth-child(13) { animation-delay: 1.7s; }
        .signature span:nth-child(14) { animation-delay: 1.8s; }
        .signature span:nth-child(15) { animation-delay: 1.9s; }
        .signature span:nth-child(16) { animation-delay: 2.0s; }
        .signature span:nth-child(17) { animation-delay: 2.1s; }
        #game-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #282c34 0%, #1a1e24 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 3000;
            transition: opacity 1s ease-out;
            display: none;
        }
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #282c34;
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #game-canvas {
            background-color: #1a1e24;
            border: 2px solid #61dafb;
            max-width: 100%;
            max-height: 60vh;
        }
        #game-ui {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        #controls-info {
            color: #abb2bf;
            font-size: 16px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            text-align: center;
            line-height: 1.5;
        }
        #close-game {
            background: #61dafb;
            color: #282c34;
            border: none;
            padding: 10px 20px;
            margin-top: 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        #mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            width: 100%;
            justify-content: center; /* Центрируем по горизонтали */
            align-items: center; /* Центрируем по вертикали */
            gap: 40px; /* Расстояние между кнопками */
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 3001;
        }
        
        .mobile-btn {
            width: 60px;
            height: 60px;
            background: rgba(97, 218, 251, 0.3);
            border: 2px solid #61dafb;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            margin: 0; /* Убираем отступы */
        }
        
        #mobile-left {
            order: 1; /* Левая кнопка - первая */
        }
        
        #mobile-jump {
            order: 2; /* Кнопка прыжка - в центре */
            width: 80px;
            height: 80px;
            margin: 0 40px; /* Отступы слева и справа */
        }
        
        #mobile-right {
            order: 3; /* Правая кнопка - последняя */
        }
        
        @media (max-width: 768px) {
            #controls-info {
                display: none;
            }
            
            #game-canvas {
                width: 100%;
                height: auto;
            }
            
            /* Адаптация для очень маленьких экранов */
            #mobile-controls {
                gap: 20px;
            }
            
            .mobile-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            #mobile-jump {
                width: 70px;
                height: 70px;
                margin: 0 20px;
            }
        }
        
        /* Стили для выбора персонажа */
        #character-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(40, 44, 52, 0.95);
            z-index: 3002;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .character-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            margin: 20px 0;
        }
        
        .character-option {
            width: 120px;
            height: 160px;
            background: rgba(97, 218, 251, 0.2);
            border: 2px solid #61dafb;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .character-option:hover {
            transform: scale(1.05);
            background: rgba(97, 218, 251, 0.3);
        }
        
        .character-option.selected {
            background: rgba(97, 218, 251, 0.4);
            border-color: #4fa8d3;
            box-shadow: 0 0 15px rgba(97, 218, 251, 0.5);
        }
        
        .character-preview {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 50%;
        }
        
        .character-name {
            font-size: 16px;
            text-align: center;
        }
        
        #select-character-btn {
            background: #61dafb;
            color: #282c34;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        #select-character-btn:hover {
            background: #4fa8d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(97, 218, 251, 0.4);
        }
        
        /* Стили для победного экрана */
        #win-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(40, 44, 52, 0.95);
            z-index: 4000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        
        .win-title {
            font-size: 36px;
            color: #61dafb;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(97, 218, 251, 0.7);
        }
        
        .win-character {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 20px 0;
            border: 3px solid #61dafb;
            box-shadow: 0 0 20px rgba(97, 218, 251, 0.5);
        }
        
        .win-message {
            font-size: 24px;
            margin-bottom: 30px;
            max-width: 80%;
        }
        
        #win-close-btn {
            background: #61dafb;
            color: #282c34;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        #win-close-btn:hover {
            background: #4fa8d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(97, 218, 251, 0.4);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        
        @media (max-width: 768px) {
            #controls-info {
                display: none;
            }
            
            #game-canvas {
                width: 100%;
                height: auto;
            }
            
            .character-options {
                gap: 10px;
            }
            
            .character-option {
                width: 100px;
                height: 140px;
            }
            
            .character-preview {
                width: 60px;
                height: 60px;
            }
            
            .win-title {
                font-size: 28px;
            }
            
            .win-message {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="name-form">
        <div class="form-container">
            <div class="form-title">Введите ваше имя и фамилию</div>
            <div class="input-group">
                <input type="text" id="last-name" class="form-input" placeholder="Фамилия" required>
                <input type="text" id="first-name" class="form-input" placeholder="Имя" required>
            </div>
            <div class="error-message" id="error-message">Ученик не найден в списке. Открытка не существует.</div>
            <button class="form-button" onclick="checkStudent()">Продолжить</button>
        </div>
    </div>
    
    <div id="loader">
        <img class="python-logo-3d" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Python-logo-notext.svg/1200px-Python-logo-notext.svg.png" alt="Python Logo">
        <div class="loader-text">Находим вашу открытку...</div>
    </div>
    
    <div id="card">
        <img class="mshp-logo" src="https://informatics.ru/img/logo-full.svg" alt="Логотип МШП">
        <h1>Поздравляю, ученик!</h1>
        <div class="code" id="code-output"></div>
        <p>Пусть твой путь в программировании будет успешным!</p>
        <div class="signature-container">
            <div class="signature">
                <span>С</span><span>е</span><span>р</span><span>г</span><span>е</span><span>й</span>
                <span> </span>
                <span>А</span><span>л</span><span>е</span><span>к</span><span>с</span><span>е</span><span>е</span><span>в</span><span>и</span><span>ч</span>
            </div>
        </div>
    </div>
    
    <div id="game-loader">
        <img class="python-logo-3d" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Python-logo-notext.svg/1200px-Python-logo-notext.svg.png" alt="Python Logo">
        <div class="loader-text">Загружаем игру...</div>
    </div>
    
    <div id="character-selection">
        <h2>Выберите персонажа</h2>
        <div class="character-options">
            <div class="character-option" data-character="default">
                <div class="character-preview" style="background-color: #61dafb;"></div>
                <div class="character-name">Программист</div>
            </div>
            <div class="character-option" data-character="ninja">
                <div class="character-preview" style="background-color: #c678dd;"></div>
                <div class="character-name">Ниндзя</div>
            </div>
            <div class="character-option" data-character="robot">
                <div class="character-preview" style="background-color: #e06c75;"></div>
                <div class="character-name">Робот</div>
            </div>
            <div class="character-option" data-character="alien">
                <div class="character-preview" style="background-color: #98c379;"></div>
                <div class="character-name">Пришелец</div>
            </div>
        </div>
        <button id="select-character-btn">Выбрать</button>
    </div>
    
    <div id="game-container">
        <div id="game-ui">Соберите 10 монет: <span id="coins-count">0</span>/10</div>
        <div id="controls-info">
            Управление: WASD или стрелки (Пробел для прыжка)
        </div>
        <canvas id="game-canvas" width="800" height="400"></canvas>
        <button id="close-game">Закрыть игру</button>
    </div>
    
    <div id="mobile-controls">
        <div id="mobile-left" class="mobile-btn">←</div>
        <div id="mobile-jump" class="mobile-btn">↑</div>
        <div id="mobile-right" class="mobile-btn">→</div>
    </div>
    
    <div id="win-screen">
        <h1 class="win-title">Поздравляем!</h1>
        <canvas class="win-character" id="win-character-preview" width="120" height="120"></canvas>
        <div class="win-message" id="win-message"></div>
        <button id="win-close-btn">Закрыть</button>
        <div id="confetti-container"></div>
    </div>
    
    <script>
        const allowedStudents = [
            "гусев илья",
            "коршунов михаил",
            "федотов светослав",
            "гаврилов владимир",
            "фролов тимофей",
            "нарицын дмитрий",
            "будылин михаил",
            "ахметова анель",
            "муравьёв богдан",
            "муравьев богдан",
            "соловьёв андрей",
            "соловьев андрей",
            "овчинников константин",
            "лебедев максим",
            "насер степан",
            "карпов лев",
            "лосев кирилл",
            "георгицэ егор",
            "иванов иван"
        ];

        // Игровые переменные
        let gameRunning = false;
        let coinsCollected = 0;
        let player, platforms, coins;
        let gameInitialized = false;
        let controlsEnabled = false;
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Персонажи
        const characters = {
            default: { 
                color: '#61dafb', 
                width: 30, 
                height: 50, 
                jumpPower: -12,
                name: 'Программист'
            },
            ninja: { 
                color: '#c678dd', 
                width: 28, 
                height: 45, 
                jumpPower: -14,
                name: 'Ниндзя'
            },
            robot: { 
                color: '#e06c75', 
                width: 32, 
                height: 55, 
                jumpPower: -10,
                name: 'Робот'
            },
            alien: { 
                color: '#98c379', 
                width: 25, 
                height: 40, 
                jumpPower: -15,
                name: 'Пришелец'
            }
        };
        
        let currentCharacter = 'default';

        function checkStudent() {
            const lastName = document.getElementById('last-name').value.trim();
            const firstName = document.getElementById('first-name').value.trim();
            const errorMessage = document.getElementById('error-message');
            
            if (!lastName || !firstName) {
                errorMessage.textContent = "Пожалуйста, введите фамилию и имя";
                errorMessage.style.display = "block";
                return;
            }
            
            const fullName = `${lastName.toLowerCase()} ${firstName.toLowerCase()}`;
            
            if (!allowedStudents.includes(fullName)) {
                errorMessage.style.display = "block";
                return;
            }
            
            errorMessage.style.display = "none";
            startCard();
        }

        function startCard() {
            const lastName = document.getElementById('last-name').value.trim();
            const firstName = document.getElementById('first-name').value.trim();
            
            document.getElementById('name-form').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('name-form').style.display = 'none';
                document.getElementById('loader').style.display = 'flex';
                
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loader').style.display = 'none';
                        document.getElementById('code-output').innerHTML = `
                            <span class="keyword">print</span>(<span class="string">"${lastName} ${firstName}"</span>)
                        `;
                        document.getElementById('card').style.display = 'block';
                        setTimeout(() => {
                            document.getElementById('card').style.opacity = '1';
                            document.getElementById('card').style.transform = 'translateY(0)';
                        }, 50);
                    }, 1000);
                }, 2500);
            }, 1000);
        }
        
        function initGame() {
            player = {
                x: 50,
                y: 300,
                width: characters[currentCharacter].width,
                height: characters[currentCharacter].height,
                velocityY: 0,
                jumping: false,
                color: characters[currentCharacter].color
            };
            
            platforms = [
                {x: 0, y: 350, width: 200, height: 20},
                {x: 250, y: 300, width: 200, height: 20},
                {x: 500, y: 250, width: 200, height: 20},
                {x: 150, y: 200, width: 200, height: 20},
                {x: 400, y: 150, width: 200, height: 20}
            ];
            
            generateCoins();
            gameInitialized = true;
        }
        
        function generateCoins() {
            coins = [];
            for (let i = 0; i < 10; i++) {
                const platform = platforms[Math.floor(Math.random() * platforms.length)];
                coins.push({
                    x: platform.x + Math.random() * (platform.width - 20),
                    y: platform.y - 30,
                    width: 20,
                    height: 20,
                    collected: false
                });
            }
        }
        
        function handleJump() {
            if (!player.jumping) {
                player.velocityY = characters[currentCharacter].jumpPower;
                player.jumping = true;
            }
        }
        
        function drawPlayer(ctx) {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Стилизация персонажей
            ctx.fillStyle = '#282c34';
            switch(currentCharacter) {
                case 'ninja':
                    // Глаза ниндзи
                    ctx.fillRect(player.x + 5, player.y + 5, 5, 5);
                    ctx.fillRect(player.x + player.width - 10, player.y + 5, 5, 5);
                    break;
                case 'robot':
                    // Экран робота
                    ctx.fillRect(player.x + 10, player.y + 10, player.width - 20, 10);
                    break;
                case 'alien':
                    // Большие глаза пришельца
                    ctx.beginPath();
                    ctx.arc(player.x + player.width/3, player.y + 15, 5, 0, Math.PI * 2);
                    ctx.arc(player.x + player.width*2/3, player.y + 15, 5, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                default:
                    // Очки программиста
                    ctx.fillRect(player.x + 5, player.y + 15, player.width - 10, 5);
                    ctx.fillRect(player.x + player.width/3, player.y + 10, 5, 15);
                    ctx.fillRect(player.x + player.width*2/3, player.y + 10, 5, 15);
            }
        }
        
        function showWinScreen() {
            gameRunning = false;
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('mobile-controls').style.display = 'none';
    
            // Настраиваем победный экран
            const winScreen = document.getElementById('win-screen');
            const winCharacter = document.getElementById('win-character-preview');
            const winMessage = document.getElementById('win-message');
            
            // Очищаем предыдущие конфетти
            document.getElementById('confetti-container').innerHTML = '';
            
            // Устанавливаем персонажа
            const ctx = winCharacter.getContext('2d');
            ctx.fillStyle = characters[currentCharacter].color;
            ctx.fillRect(0, 0, winCharacter.width, winCharacter.height);
    
            // Стилизация персонажа
            ctx.fillStyle = '#282c34';
            switch(currentCharacter) {
                case 'ninja':
                    // Глаза ниндзи
                    ctx.fillRect(40, 40, 10, 10);
                    ctx.fillRect(70, 40, 10, 10);
                    break;
                case 'robot':
                    // Экран робота
                    ctx.fillRect(30, 40, 60, 20);
                    break;
                case 'alien':
                    // Большие глаза пришельца
                    ctx.beginPath();
                    ctx.arc(40, 50, 15, 0, Math.PI * 2);
                    ctx.arc(80, 50, 15, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                default:
                    // Очки программиста
                    ctx.fillRect(30, 50, 60, 10);
                    ctx.fillRect(40, 40, 10, 30);
                    ctx.fillRect(70, 40, 10, 30);
            }
            
            // Устанавливаем сообщение
            winMessage.textContent = `${characters[currentCharacter].name} собрал все монеты!`;
            
            // Показываем победный экран
            winScreen.style.display = 'flex';
            
            // Запускаем конфетти
            createConfetti();
    
            // Обработчик закрытия
            document.getElementById('win-close-btn').onclick = function() {
                winScreen.style.display = 'none';
                document.getElementById('card').style.display = 'block';
                controlsEnabled = false;
                Object.keys(keys).forEach(key => { keys[key] = false; });
            };
        }
        
        function createConfetti() {
            const colors = ['#61dafb', '#c678dd', '#e06c75', '#98c379', '#FFD700', '#ff6b6b'];
            const container = document.getElementById('confetti-container');
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = -10 + 'px';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                
                container.appendChild(confetti);
                
                // Анимация падения
                const animation = confetti.animate([
                    { top: '-10px', opacity: 1, transform: `rotate(${Math.random() * 360}deg)` },
                    { top: '100vh', opacity: 0.5 }
                ], {
                    duration: 2000 + Math.random() * 3000,
                    delay: Math.random() * 2000
                });
                
                // Удаляем конфетти после анимации
                animation.onfinish = () => confetti.remove();
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('code-output').addEventListener('click', function(e) {
                if (e.target.classList.contains('keyword') || e.target.classList.contains('string')) {
                    showGameLoader();
                }
            });
        });

        function showGameLoader() {
            document.getElementById('card').style.display = 'none';
            document.getElementById('game-loader').style.display = 'flex';
            document.getElementById('game-loader').style.opacity = '1';
            
            setTimeout(() => {
                document.getElementById('game-loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('game-loader').style.display = 'none';
                    resetCharacterSelection();
                    showCharacterSelection();
                }, 1000);
            }, 2000);
        }
        
        function resetCharacterSelection() {
            const characterOptions = document.querySelectorAll('.character-option');
            characterOptions.forEach(opt => opt.classList.remove('selected'));
            characterOptions[0].classList.add('selected');
            currentCharacter = 'default';
        }
        
        function showCharacterSelection() {
            document.getElementById('character-selection').style.display = 'flex';
            
            const characterOptions = document.querySelectorAll('.character-option');
            characterOptions.forEach(option => {
                option.addEventListener('click', function() {
                    characterOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    currentCharacter = this.getAttribute('data-character');
                });
            });
            
            // Удаляем старый обработчик и добавляем новый
            const selectBtn = document.getElementById('select-character-btn');
            selectBtn.replaceWith(selectBtn.cloneNode(true));
            document.getElementById('select-character-btn').addEventListener('click', startGameAfterSelection);
        }
        
        function startGameAfterSelection() {
            document.getElementById('character-selection').style.display = 'none';
            
            // Показываем загрузчик игры снова
            document.getElementById('game-loader').style.display = 'flex';
            document.getElementById('game-loader').style.opacity = '1';
            
            setTimeout(() => {
                document.getElementById('game-loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('game-loader').style.display = 'none';
                    
                    gameRunning = true;
                    coinsCollected = 0;
                    document.getElementById('coins-count').textContent = '0';
                    document.getElementById('game-container').style.display = 'flex';
                    
                    if (isMobile) {
                        document.getElementById('mobile-controls').style.display = 'flex';
                    }
                    
                    controlsEnabled = true;
                    
                    initGame();
                    gameLoop();
                }, 1000);
            }, 1500);
        }
        
        document.getElementById('close-game').addEventListener('click', function() {
            gameRunning = false;
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('mobile-controls').style.display = 'none';
            document.getElementById('card').style.display = 'block';
            
            controlsEnabled = false;
            Object.keys(keys).forEach(key => { keys[key] = false; });
        });
        
        const keys = {};
        const keyMap = {
            'w': 'up', 'a': 'left', 's': 'down', 'd': 'right',
            'ц': 'up', 'в': 'right', 'ф': 'left', 'ы': 'down', 'н': 'jump',
            'arrowup': 'up', 'arrowleft': 'left', 'arrowright': 'right', 'arrowdown': 'down',
            ' ': 'jump', 'space': 'jump'
        };
        
        window.addEventListener('keydown', function(e) {
            if (!controlsEnabled) return;
            
            const key = e.key.toLowerCase();
            const action = keyMap[key] || keyMap[e.code.toLowerCase()];
            
            if (action) {
                keys[action] = true;
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', function(e) {
            if (!controlsEnabled) return;
            
            const key = e.key.toLowerCase();
            const action = keyMap[key] || keyMap[e.code.toLowerCase()];
            
            if (action) {
                keys[action] = false;
                e.preventDefault();
            }
        });
        
        function setupMobileControls() {
            const leftBtn = document.getElementById('mobile-left');
            const rightBtn = document.getElementById('mobile-right');
            const jumpBtn = document.getElementById('mobile-jump');
            
            const handleTouchStart = (action) => {
                return (e) => {
                    if (!controlsEnabled) return;
                    keys[action] = true;
                    e.preventDefault();
                };
            };
            
            const handleTouchEnd = (action) => {
                return (e) => {
                    if (!controlsEnabled) return;
                    keys[action] = false;
                    e.preventDefault();
                };
            };
            
            leftBtn.addEventListener('touchstart', handleTouchStart('left'), {passive: false});
            leftBtn.addEventListener('touchend', handleTouchEnd('left'), {passive: false});
            leftBtn.addEventListener('touchcancel', handleTouchEnd('left'), {passive: false});
            
            rightBtn.addEventListener('touchstart', handleTouchStart('right'), {passive: false});
            rightBtn.addEventListener('touchend', handleTouchEnd('right'), {passive: false});
            rightBtn.addEventListener('touchcancel', handleTouchEnd('right'), {passive: false});
            
            jumpBtn.addEventListener('touchstart', handleTouchStart('jump'), {passive: false});
            jumpBtn.addEventListener('touchend', handleTouchEnd('jump'), {passive: false});
            jumpBtn.addEventListener('touchcancel', handleTouchEnd('jump'), {passive: false});
            
            leftBtn.addEventListener('mousedown', handleTouchStart('left'));
            leftBtn.addEventListener('mouseup', handleTouchEnd('left'));
            leftBtn.addEventListener('mouseleave', handleTouchEnd('left'));
            
            rightBtn.addEventListener('mousedown', handleTouchStart('right'));
            rightBtn.addEventListener('mouseup', handleTouchEnd('right'));
            rightBtn.addEventListener('mouseleave', handleTouchEnd('right'));
            
            jumpBtn.addEventListener('mousedown', handleTouchStart('jump'));
            jumpBtn.addEventListener('mouseup', handleTouchEnd('jump'));
            jumpBtn.addEventListener('mouseleave', handleTouchEnd('jump'));
        }
        
        function gameLoop() {
            if (!gameRunning) return;
            
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (keys['left']) {
                player.x -= 5;
                if (player.x < 0) player.x = 0;
            }
            if (keys['right']) {
                player.x += 5;
                if (player.x > canvas.width - player.width) {
                    player.x = canvas.width - player.width;
                }
            }
            
            if ((keys['jump'] || keys['up']) && !player.jumping) {
                handleJump();
            }
            
            player.velocityY += 0.5;
            player.y += player.velocityY;
            
            player.jumping = true;
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y &&
                    player.velocityY > 0) {
                    
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.jumping = false;
                }
            });
            
            if (player.y > canvas.height) {
                player.y = 0;
                player.velocityY = 0;
            }
            
            coins.forEach(coin => {
                if (!coin.collected &&
                    player.x < coin.x + coin.width &&
                    player.x + player.width > coin.x &&
                    player.y < coin.y + coin.height &&
                    player.y + player.height > coin.y) {
                    
                    coin.collected = true;
                    coinsCollected++;
                    document.getElementById('coins-count').textContent = coinsCollected;
                    
                    if (coinsCollected >= 10) {
                        showWinScreen();
                    }
                }
            });
            
            drawPlayer(ctx);
            
            ctx.fillStyle = '#98c379';
            platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });
            
            ctx.fillStyle = '#FFD700';
            coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.beginPath();
                    ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            requestAnimationFrame(gameLoop);
        }
        
        window.addEventListener('load', function() {
            document.getElementById('last-name').focus();
            setupMobileControls();
            
            if (isMobile) {
                document.getElementById('controls-info').style.display = 'none';
            }
        });
    </script>
</body>
</html>